<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Messages</title>
    <style>
        body { font-family: sans-serif; max-width: 900px; margin: 2rem auto; }
        nav { display: flex; gap: 1rem; align-items: center; }
        .row { display: grid; grid-template-columns: 250px 1fr; gap: 1rem; margin-top: 1rem; }
        .bubble { border: 1px solid #ddd; padding: .5rem .75rem; border-radius: 8px; margin: .35rem 0; }
        .mine { background: #f5f5f5; }
        ul { padding-left: 1rem; }
        li { margin: .25rem 0; }
    </style>
</head>
<body>
<nav>
    <a href="/">Home</a>
    <a href="/friends">Friends</a>
    <form method="post" action="/logout" style="margin-left:auto">
        <button type="submit">Logout</button>
    </form>
</nav>

<div class="row">
    <aside>
        <h4>Users</h4>
        <ul>
            <li th:each="u : ${users}">
                <a th:href="@{'/messages'(with=${u.id})}" th:text="${u.displayName}"></a>
            </li>
        </ul>
    </aside>
    <main>
        <div th:if="${other}">
            <h3 th:text="'Chat with ' + ${other.displayName}"></h3>
            <div th:each="m : ${history}" class="bubble" th:classappend="${m.sender.id == me.id} ? ' mine'">
                <strong th:text="${m.sender.displayName}"></strong>
                <span th:text="${#temporals.format(m.createdAt, 'HH:mm')}"></span>
                <div th:text="${m.content}"></div>
            </div>
            <form method="post" action="/messages">
                <input type="hidden" name="toUserId" th:value="${other.id}"/>
                <input name="content" placeholder="Type a message" required style="width:80%"/>
                <button type="submit">Send</button>
            </form>
        </div>
        <div th:if="${other == null}">
            <p>Select a user to start chatting.</p>
        </div>
    </main>
    </div>
</body>
</html>


